
# "生態学と因果推論1"
author: "Ph.D. Ohkubo Yusaku"
date: "2/18/2022"

## はじめに
近頃、生態学でも徐々に統計的因果推論に対する関心が高まっている。しかし、なぜそもそも既存の方法ではいけないのだろうか？生態学では一般化線形モデル(GLM)やその拡張（GLMM）が広く普及し、それらを情報量規準(AICやBIC)等で比較する手順がある種のゴールドスタンダードとして機能してきた。これらの手法はどの説明変数が“効いて”いるのか判断するのにも使われていると思われる（例えば「XXの効果も考慮した方が良いのではないか」といった質問に対しては「その変数を投入したモデルがAICで選ばれなかった」ことが結果の根拠して示される）。情報量規準の重視は生態学に固有の状況かもしれないが、こうした状況がどのような問題を引き起こすのか認識しない限り、わざわざコストをかけて新たな手法を習得するモチベーションは得られないであろう。

そこで本稿では、ごく簡単なシミュレーション実験を通して一般的な情報量規準と統計的因果推論の関係性について例示する。統計的因果推論の理論や具体的な手法についてはすでに多くの良書が世に出ているため、末尾の文献紹介をつけることとしこの記事では取り扱わない。尚、この記事はESJ69の自由集会「フィールドワークと統計モデリング：「現場の勘」の活かしどころ」で発表予定の講演[W-13-1]のために大久保が個人的に用意した予備資料を兼ねている。

## 問題設定（1）：バックドア基準
ここでは黒木学(2005)『統計的因果推論』(朝倉書店)の例を参考にする。実世界に5つの変数W、X、Y、Z1、Z2が存在するとしよう。それぞれの変数が、気温だとか、ある生物の個体数だとか、人為的な撹乱の強さだとか、なにか普段の研究であつかう変数だと考えて欲しい。以下では、説明変数Xが目的変数Yに対してどれくらいの影響を与えているか知ることが研究の関心であると仮定する。（「すべての変数に等しく関心があるのではなく、ある興味をもった変数とそれ以外の“邪魔な”変数が混ざっている」という想定は様々な統計的因果推論の手法でミソとなるポイントであり、こうした状況は実際の生態学でもよくあるように思う。）

上記の変数はネットワーク構造を成し（図を参照）、矢印の根本から先に向かって“因果”効果を与えているものとする。具体的には、それぞれの変数がこの以下のような関係に従っている。

Z2 ~ Normal(0, 10)

Z1 ~ 1.2*Z2 + Normal(0,1)

W ~ -0.5*Z1 + Normal(0, 1)

X ~ 0.5*Z2 + Normal(0, 1)

Y ~ 0.1*W – 0.5*X + 0.5*Z1 + Normal(0, 10)

各係数は適当に与えたものなので、適宜変えても構わない。さて、現実の問題では上式のような係数（パラメータ）はわからないので各変数の有限な観測データから推定をしていくことになる。先述のように今回の関心は「X→Y」の部分にあるので、最後の式にあるXの回帰パラメータ0.5の部分を的中させたいということになる。

統計的因果推論の理論によれば、Xについて統計的に妥当(不偏)な推定を行うためには、「目的変数をYとした回帰モデルに、説明変数としてXおよびバックドアバックドア基準を満たす変数を投入するべきだ」と明らかにされている（バックドア基準の詳細は省くが、ここではZ1かZ2のどちらかを投入すればバックドア基準が満たされる）。つまり、AICによってモデル選択を行うのではなく、変数Z1もしくはZ2を強制投入した上でXの回帰係数を推定したり検定すべきである。

では、この指針を無視してAICによるモデル選択を行うとどのような事態が生じるのだろうか。ここで、以下のような三つの回帰モデルを設定してAICを算出してみる。

モデル1： Y ~ X

モデル2： Y ~ X + Z1

モデル3： Y ~ X + Z2

N=100のデータセットで10000回実験すると、モデル1 VS モデル2でもモデル1 VS モデル3でも全体の60％でモデル1が選ばれる。つまりバックドア基準を満たさないモデルであり、推定値にバイアスを産むモデルが選択される。(さらにいうとポストモデル選択問題もあるが、一旦脇に置く)。
```{r }
N.sim<- 10000
N.sample<- 100

sig.y<- 10

result<- matrix(0, N.sim, 6) 
for (i in 1:N.sim){
　z2<- rnorm(N.sample, 0, 10) # covariate
  z1<- 1.2*z2 + rnorm(N.sample, 0, 1) # covariate
  w<- -0.5*z1 + rnorm(N.sample, 0, 1) 
  x<- 0.5*z2 + rnorm(N.sample, 0, 1) # target variable
  y<- 0.1*w - 0.5*x + 0.5*z1 + rnorm(N.sample, 0, sig.y) # outcome

  # the true "causal effect" is -0.5
  model1<- lm(y ~ x) # a model yielding biased estimate
  model2<- lm(y ~ x +z1) # satisfying backdoor criterion
  model3<- lm(y ~ x +z2) # satisfying backdoor criterion
  
  result[i,1]<- model1$coefficients[2] 
  result[i,2]<- model2$coefficients[2]
  result[i,3]<- model3$coefficients[2]
  
  result[i,4]<- AIC(model1)
  result[i,5]<- AIC(model2)
  result[i,6]<- AIC(model3)
}

# delta_AIC
hist(result[,4] - result[,5], xlab="AIC(M1)-AIC(M2)")
  abline(v=0, col=2)
hist(result[,4] - result[,6], xlab="AIC(M1)-AIC(M3)")
summary(result)
  abline(v=0, col=2)

summary(result[,4] - result[,5])
summary(result[,4] - result[,6])

tmp1<- (result[,4] - result[,5])
tmp2<- (result[,4] - result[,6])

# smaller model is chosen in almost 60& of times
length(tmp1[tmp1<0])
length(tmp2[tmp2<0]) 
```


## 問題設定（2）：傾向スコアによる処置効果推定
(準備中)

## 参考文献
黒木学(2004)『統計的因果推論-回帰分析の新しい枠組み』(朝倉書店)
岩崎学(2015)『統計的因果推論』(朝倉書店)
-(生態学の基準から見ると、やや数理統計寄りである)
高橋将宜(2022)『統計的因果推論の理論と実装』
-(Rコードが豊富で大変わかりやすいという評判のようだ)
